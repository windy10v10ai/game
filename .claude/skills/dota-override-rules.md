---
name: dota-override-rules
description: Dota 2 自定义地图 Override 技能规则。定义技能等级提升、数值调整、KV格式、注释规范等规则。用于处理 Dota 2 更新时的技能数据维护。
---

# Dota 2 Override 规则

本文档定义了 `game/scripts/npc/npc_abilities_override.txt` 中技能数据的维护规则。

---

## 等级提升规则

| 技能类型 | MaxLevel |
| -------- | -------- |
| 小技能   | 5 级     |
| 大招     | 4 级     |
| 特殊技能 | 单独处理 |

---

## KV 格式规则

- **只填写 override 的内容**，不需要全部复制
- KV 结构遵循 Dota 2 定义
- 如果每级数值不同，需要适配修改后的最大等级

---

## 数值调整规则

### 基本原则

- 优先采用**等差数列**扩展
- 每级数值尽量保持**整数**或 **5、10 的倍数**

### 扩展规则

扩展到更高等级时（无加强/削弱）：

1. **前 4 级保持与官方相同**
2. 计算官方数值的等差规律
3. 按等差规律添加第 5 级

### 加强/削弱规则

当 override 值与官方值存在差异时，是**有意图的加强或削弱**，更新时保持加强方式。

| 加强方式          | 旧官方值        | 旧值                | 新官方值        | 新值                | 注释                 |
| ----------------- | --------------- | ------------------- | --------------- | ------------------- | -------------------- |
| 固定差异          | 100 120 140 160 | 110 130 150 170 180 | 110 130 150 170 | 120 140 160 180 190 | `// 110 130 150 170` |
| 倍数加强          | 20 25 30 35     | 40 50 60 70 80      | 25 30 35 40     | 50 60 70 80 90      | `// 25 30 35 40 x2`  |
| 调整等差          | 250 350 450     | 250 400 550 700     | 300 400 500     | 300 450 600 750     | `// 300 400 500`     |
| 固定值→随等级增加 | 5               | 10 15 20 25 30      | 6               | 12 18 24 30 36      | `// 6`               |

### 特殊情况

以下情况保持最大等级数值不变：

- 过于短暂的 CD：小技能最大等级 CD ≤ 5s，大招最大等级 CD ≤ 60s
- 百分比数值已达上限
- radius 等固定范围属性

### 示例

```
特殊情况 - 小技能 (最大等级 CD ≤ 5s):
官方 4 级: 8 7 6 5
扩展到 5 级: 9 8 7 6 5 (添加第1级，保持最大值不变，等差过小时保持等差不变)

官方 4 级: 20 15 10 5
扩展到 5 级: 21 17 13 9 5 (添加第1级，保持最大值不变，等差过大时调整等差)

特殊情况 - 大招 (最大等级 CD ≤ 60s):
官方 3 级: 70 50 30
扩展到 4 级: 70 60 40 30 (添加第1级，保持最大值30不变，等差从-15改成-10)
```

---

## 注释规则

在 value 后添加注释标注官方原数值：

```kv
"value" "150 165 180 195 210" // 150 170 190 210
```

当官方数值更新时，同步更新注释。

---

## 数值数量匹配规则

- 数值个数**必须与 MaxLevel 匹配**
- 如 `MaxLevel=4`，则数值必须有 4 个
- 发现不匹配时需要修正

---

## 文件检索技巧

由于文件较长，必须使用精确检索：

### 在 override 文件中查找

使用 Grep 搜索技能名（英文），`-n` 参数显示行号：

```bash
grep -n "hero_ability_name" game/scripts/npc/npc_abilities_override.txt
```

### 在英雄参考文件中查找

```
docs/reference/{version}/heroes/npc_dota_hero_{hero_name}.txt
```

### 在中文技能名文件中查找

```bash
grep "技能名" docs/reference/{version}/abilities_schinese.txt
```

---

## 注意事项

### ✅ 应该做的

- 使用 Grep 精确定位技能位置，不要读取整个文件
- 数值个数必须与 MaxLevel 匹配
- 有意加强/削弱时，保持加强方式
- **属性删除**：官方删除某属性时，删除相关 override block
- **技能移除**：官方移除整个技能时，删除对应 override block
- **与官方值相同**：更新后若与官方值相同，移除该属性

### ❌ 不应该做的

- 不要复制官方所有属性，只 override 必要的部分

### 不需要修改

- 当前 override 已是合理扩展且与新版本兼容
- 机制变更不涉及已 override 的数值
- 未 override 的天赋会自动使用官方新值

### 性能优化

为防止卡顿，部分技能禁用幻象/召唤物：`"duration_illusion" "0"`

---

## 用户交互规则

### 交互流程

1. **首先显示修改汇总表格**
2. **仅对不确定的地方提问**（如多种加强方式可选、新属性处理方式等）
3. **提供编号方案**：当有多个可选方案时，提供 1、2、3 等编号，用户只需回复数字选择

### 修改汇总格式

| 属性   | 旧官方值 | 当前 Override | 新官方值 | 建议更新 |
| ------ | -------- | ------------- | -------- | -------- |
| 属性名 | 旧版官方 | 修改前        | 新版官方 | 修改后   |

技能中文名在 `docs/reference/7.40/abilities_schinese.txt` 中查找

### 注释始终同步

官方数值更新时，**始终更新注释为新官方值**，无需询问用户。

---

## Bot Build 天赋检测

Bot 天赋配置在 `game/scripts/npc/npc_heroes_custom.txt`，需与官方天赋定义匹配。

### 天赋等级对应关系

| 等级 | 官方 Ability         |
| ---- | -------------------- |
| 10级 | Ability10, Ability11 |
| 15级 | Ability12, Ability13 |
| 20级 | Ability14, Ability15 |
| 25级 | Ability16, Ability17 |

### Bot Build 加点顺序

- 10/15/20/25 级：每个档位选一个天赋
- 27/28/29/30 级：补全各档位另一侧天赋

### 检测方法

1. 读取 `docs/reference/{version}/npc_heroes.txt` 中英雄的 Ability10-17
2. 读取 `game/scripts/npc/npc_heroes_custom.txt` 中英雄的 Bot Build
3. 验证 10/15/20/25/27/28/29/30 级的天赋是否在对应档位的 Ability 中
